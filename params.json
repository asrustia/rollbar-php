{"name":"Rollbar-php","tagline":"Error tracking and logging from PHP to Rollbar","body":"# Rollbar notifier for PHP [![Build Status](https://travis-ci.org/rollbar/rollbar-php.png?branch=v0.15.0)](https://travis-ci.org/rollbar/rollbar-php)\r\n\r\n<!-- RemoveNext -->\r\n\r\nThis library detects errors and exceptions in your application and reports them to [Rollbar](https://rollbar.com) for alerts, reporting, and analysis.\r\n\r\n<!-- Sub:[TOC] -->\r\n\r\n## Quick start\r\n\r\n```php\r\n<?php\r\n// installs global error and exception handlers\r\nRollbar::init(array('access_token' => 'POST_SERVER_ITEM_ACCESS_TOKEN'));\r\n\r\ntry {\r\n    throw new Exception('test exception');\r\n} catch (Exception $e) {\r\n    Rollbar::report_exception($e);\r\n}\r\n\r\n// Message at level 'info'\r\nRollbar::report_message('testing 123', 'info');\r\n\r\n// With extra data (3rd arg) and custom payload options (4th arg)\r\nRollbar::report_message('testing 123', 'info',\r\n                        // key-value additional data\r\n                        array(\"some_key\" => \"some value\"),  \r\n                        // payload options (overrides defaults) - see api docs\r\n                        array(\"fingerprint\" => \"custom-fingerprint-here\"));\r\n\r\n// raises an E_NOTICE which will *not* be reported by the error handler\r\n$foo = $bar;\r\n\r\n// will be reported by the exception handler\r\nthrow new Exception('test 2');\r\n?>\r\n```\r\n\r\n## Installation\r\n\r\n### General\r\n\r\nDownload [rollbar.php](https://raw.github.com/rollbar/rollbar-php/master/src/rollbar.php) and put it somewhere you can access.\r\n\r\n### If Using Composer\r\n\r\nAdd `rollbar/rollbar` to your `composer.json`:\r\n\r\n```json\r\n{\r\n    \"require\": {\r\n        \"rollbar/rollbar\": \"~0.15.0\"\r\n    }\r\n}\r\n```\r\n\r\n## Setup\r\n\r\nAdd the following code at your application's entry point:\r\n\r\n```php\r\n<?php\r\nrequire_once 'rollbar.php';\r\n\r\n$config = array(\r\n    // required\r\n    'access_token' => 'POST_SERVER_ITEM_ACCESS_TOKEN',\r\n    // optional - environment name. any string will do.\r\n    'environment' => 'production',\r\n    // optional - path to directory your code is in. used for linking stack traces.\r\n    'root' => '/Users/brian/www/myapp'\r\n);\r\nRollbar::init($config);\r\n?>\r\n```\r\n<!-- RemoveNextIfProject -->\r\nBe sure to replace ```POST_SERVER_ITEM_ACCESS_TOKEN``` with your project's ```post_server_item``` access token, which you can find in the Rollbar.com interface.\r\n\r\nThis will install an exception handler (with `set_exception_handler`) and an error handler (with `set_error_handler`). If you'd rather not do that:\r\n\r\n```php\r\n<?php\r\n$set_exception_handler = false;\r\n$set_error_handler = false;\r\nRollbar::init($config, $set_exception_handler, $set_error_handler);\r\n?>\r\n```\r\n\r\n### For Heroku Users\r\n\r\nFirst, add the addon:\r\n\r\n```\r\nheroku addons:create rollbar:free\r\n```\r\n\r\nThe `access_token` and `root` config variables will be automatically detected, so the config is simply:\r\n\r\n```php\r\n<?php\r\nRollbar::init(array(\r\n    'environment' => 'production'\r\n));\r\n?>\r\n```\r\n\r\n## Basic Usage\r\n\r\nThat's it! Uncaught errors and exceptions will now be reported to Rollbar.\r\n\r\nIf you'd like to report exceptions that you catch yourself:\r\n\r\n```php\r\n<?php\r\ntry {\r\n    do_something();\r\n} catch (Exception $e) {\r\n    Rollbar::report_exception($e);\r\n}\r\n?>\r\n```\r\n\r\nYou can also send Rollbar log-like messages:\r\n\r\n```php\r\n<?php\r\nRollbar::report_message('could not connect to mysql server', 'warning');\r\nRollbar::report_message('Here is a message with some additional data', 'info', \r\n    array('x' => 10, 'code' => 'blue'));\r\n?>\r\n```\r\n\r\n## Batching\r\n\r\nBy default, payloads are batched and sent to the Rollbar servers at the end of every script execution via a shutdown handler, or when the batch size reaches 50, whichever comes first. This works well in standard short-lived scripts, like serving web requests.\r\n\r\nIf you're using Rollbar in a long-running script, such as a Laravel project or a background worker, you may want to manually flush the batch. To flush, simply call:\r\n\r\n```php\r\nRollbar::flush();\r\n```\r\n\r\nFor example, if using Laravel, add the above line to your `App::after()` event handler. Or in a looping background worker, call it at the end of each loop.\r\n\r\nYou can also tune the max batch size or disable batching altogether. See the `batch_size` and `batched` config variables, documented below.\r\n\r\n\r\n## Configuration\r\n\r\n### Asynchronous Reporting\r\n\r\nBy default, payloads (batched or not) are sent as part of script execution. This is easy to configure but may negatively impact performance. With some additional setup, payloads can be written to a local relay file instead; that file will be consumed by [rollbar-agent](https://github.com/rollbar/rollbar-agent) asynchronously. To turn this on, set the following config params:\r\n\r\n```php\r\n<?php\r\n$config = array(\r\n  // ... rest of current config\r\n  'handler' => 'agent',\r\n  'agent_log_location' => '/var/www'  // not including final slash. must be writeable by the user php runs as.\r\n);\r\n?>\r\n```\r\n\r\nYou'll also need to run the agent. See the [rollbar-agent docs](https://github.com/rollbar/rollbar-agent) for setup instructions.\r\n\r\n### Configuration reference\r\n\r\nAll of the following options can be passed as keys in the `$config` array.\r\n\r\n  <dl>\r\n  <dt>access_token</dt>\r\n  <dd>Your project access token.\r\n  </dd>\r\n  \r\n  <dt>agent_log_location</dt>\r\n  <dd>Path to the directory where agent relay log files should be written. Should not include final slash. Only used when handler is `agent`.\r\n  \r\nDefault: `/var/www`\r\n  </dd>\r\n  \r\n  <dt>base_api_url</dt>\r\n  <dd>The base api url to post to.\r\n  \r\nDefault: `https://api.rollbar.com/api/1/`\r\n  </dd>\r\n\r\n  <dt>batch_size</dt>\r\n  <dd>Flush batch early if it reaches this size.\r\n  \r\nDefault: `50`\r\n  </dd>\r\n\r\n  <dt>batched</dt>\r\n  <dd>True to batch all reports from a single request together.\r\n  \r\nDefault: `true`\r\n  </dd>\r\n\r\n  <dt>branch</dt>\r\n  <dd>Name of the current branch.\r\n  \r\nDefault: `master`\r\n  </dd>\r\n\r\n  <dt>capture_error_stacktraces</dt>\r\n  <dd>Record full stacktraces for PHP errors.\r\n  \r\nDefault: `true`\r\n  </dd>\r\n  \r\n  <dt>code_version</dt>\r\n  <dd>The currently-deployed version of your code/application (e.g. a Git SHA). Should be a string.\r\n  \r\nDefault: `null`\r\n  </dd>\r\n\r\n  <dt>environment</dt>\r\n  <dd>Environment name, e.g. `'production'` or `'development'`\r\n\r\nDefault: `'production'`\r\n  </dd>\r\n\r\n  <dt>error_sample_rates</dt>\r\n  <dd>Associative array mapping error numbers to sample rates. Sample rates are ratio out of 1, e.g. 0 is \"never report\", 1 is \"always report\", and 0.1 is \"report 10% of the time\". Sampling is done on a per-error basis.\r\n  \r\nDefault: empty array, meaning all errors are reported.\r\n  </dd>\r\n\r\n  <dt>handler</dt>\r\n  <dd>Either `'blocking'` or `'agent'`. `'blocking'` uses curl to send requests immediately; `'agent'` writes a relay log to be consumed by [rollbar-agent](https://github.com/rollbar/rollbar-agent).\r\n  \r\nDefault: `'blocking'`\r\n  </dd>\r\n\r\n  <dt>host</dt>\r\n  <dd>Server hostname.\r\n  \r\nDefault: `null`, which will result in a call to `gethostname()` (or `php_uname('n')` if that function does not exist)\r\n  </dd>\r\n  \r\n  <dt>included_errno</dt>\r\n  <dd>A bitmask that includes all of the error levels to report. E.g. (E_ERROR | E_WARNING) to only report E_ERROR and E_WARNING errors. This will be used in combination with `error_reporting()` to prevent reporting of errors if `use_error_reporting` is set to `true`.\r\n  \r\nDefault: (E_ERROR | E_WARNING | E_PARSE | E_CORE_ERROR | E_USER_ERROR | E_RECOVERABLE_ERROR)\r\n  </dd>\r\n\r\n  <dt>logger</dt>\r\n  <dd>An object that has a `log($level, $message)` method. If provided, will be used by RollbarNotifier to log messages.\r\n  </dd>\r\n\r\n  <dt>person</dt>\r\n  <dd>An associative array containing data about the currently-logged in user. Required: `id`, optional: `username`, `email`. All values are strings.\r\n  </dd>\r\n\r\n  <dt>person_fn</dt>\r\n  <dd>A function reference (string, etc. - anything that [call_user_func()](http://php.net/call_user_func) can handle) returning an array like the one for 'person'.\r\n  </dd>\r\n\r\n  <dt>root</dt>\r\n  <dd>Path to your project's root dir\r\n  </dd>\r\n\r\n  <dt>scrub_fields</dt>\r\n  <dd>Array of field names to scrub out of _POST and _SESSION. Values will be replaced with asterisks. If overridiing, make sure to list all fields you want to scrub, not just fields you want to add to the default. Param names are converted to lowercase before comparing against the scrub list.\r\n  \r\nDefault: `('passwd', 'password', 'secret', 'confirm_password', 'password_confirmation', 'auth_token', 'csrf_token')`\r\n  </dd>\r\n\r\n  <dt>shift_function</dt>\r\n  <dd>Whether to shift function names in stack traces down one frame, so that the function name correctly reflects the context of each frame.\r\n  \r\nDefault: `true`\r\n  </dd>\r\n\r\n  <dt>timeout</dt>\r\n  <dd>Request timeout for posting to rollbar, in seconds.\r\n  \r\nDefault: `3`\r\n  </dd>\r\n\r\n  <dt>report_suppressed</dt>\r\n  <dd>Sets whether errors suppressed with '@' should be reported or not\r\n  \r\nDefault: `false`\r\n  </dd>\r\n\r\n  <dt>use_error_reporting</dt>\r\n  <dd>Sets whether to respect current `error_reporting()` level or not\r\n  \r\nDefault: `false`\r\n  </dd>\r\n  \r\n  <dt>proxy</dt>\r\n  <dd>Send data via a proxy server.\r\n\r\nE.g. Using a local proxy with no authentication\r\n\r\n```php\r\n<?php\r\n$config['proxy'] = \"127.0.0.1:8080\";\r\n?>\r\n```\r\n\r\nE.g. Using a local proxy with basic authentication\r\n\r\n```php\r\n<?php\r\n$config['proxy'] = array(\r\n    'address' => '127.0.0.1:8080',\r\n    'username' => 'my_user',\r\n    'password' => 'my_password'\r\n);\r\n?>\r\n```\r\n\r\nDefault: No proxy\r\n  </dd>\r\n  \r\n  </dl>\r\n\r\nExample use of error_sample_rates:\r\n```php\r\n<?php\r\n$config['error_sample_rates'] = array(\r\n    // E_WARNING omitted, so defaults to 1\r\n    E_NOTICE => 0.1,\r\n    E_USER_ERROR => 0.5,\r\n    // E_USER_WARNING will take the same value, 0.5\r\n    E_USER_NOTICE => 0.1,\r\n    // E_STRICT and beyond will all be 0.1\r\n);\r\n?>\r\n```\r\n\r\nExample use of person_fn:\r\n```php\r\n<?php\r\nfunction get_current_user() {\r\n    if ($_SESSION['user_id']) {\r\n        return array(\r\n            'id' => $_SESSION['user_id'], // required - value is a string\r\n            'username' => $_SESSION['username'], // optional - value is a string\r\n            'email' => $_SESSION['user_email'] // optional - value is a string\r\n        );\r\n    }\r\n    return null;\r\n}\r\n$config['person_fn'] = 'get_current_user';\r\n?>\r\n```\r\n\r\n## Related projects\r\n\r\nA Laravel-specific package is available for integrating with Laravel: [Laravel-Rollbar](https://github.com/jenssegers/Laravel-Rollbar)\r\n\r\nA CakePHP-specific package is avaliable for integrating with CakePHP 2.x:\r\n[CakeRollbar](https://github.com/tranfuga25s/CakeRollbar)\r\n\r\n\r\n## Help / Support\r\n\r\nIf you run into any issues, please email us at [support@rollbar.com](mailto:support@rollbar.com)\r\n\r\nYou can also find us in IRC: [#rollbar on chat.freenode.net](irc://chat.freenode.net/rollbar)\r\n\r\nFor bug reports, please [open an issue on GitHub](https://github.com/rollbar/rollbar-php/issues/new).\r\n\r\n\r\n## Contributing\r\n\r\n1. Fork it\r\n2. Create your feature branch (`git checkout -b my-new-feature`)\r\n3. Commit your changes (`git commit -am 'Added some feature'`)\r\n4. Push to the branch (`git push origin my-new-feature`)\r\n5. Create new Pull Request\r\n\r\nTests are in `tests`. To run the tests: `phpunit`\r\n","google":"UA-74041710-1","note":"Don't delete this file! It's used internally to help with page regeneration."}